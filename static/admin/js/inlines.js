/**
 * Django admin inlines
 *
 * Based on jQuery Formset 1.1
 * @author Stanislaus Madueke (stan DOT madueke AT gmail DOT com)
 * @requires jQuery 1.2.6 or later
 *
 * Copyright (c) 2009, Stanislaus Madueke
 * All rights reserved.
 *
 * Spiced up with Code from Zain Memon's GSoC project 2009
 * and modified for Django by Jannis Leidel, Travis Swicegood and Julien Phalip.
 *
 * Licensed under the New BSD License
 * See: http://www.opensource.org/licenses/bsd-license.php
 */

!function(e){e.fn.formset=function(t){var a=e.extend({},e.fn.formset.defaults,t),i=e(this),s=i.parent(),n=function(t,a,i){var s=new RegExp("("+a+"-(\\d+|__prefix__))"),n=a+"-"+i;e(t).prop("for")&&e(t).prop("for",e(t).prop("for").replace(s,n)),t.id&&(t.id=t.id.replace(s,n)),t.name&&(t.name=t.name.replace(s,n))},r=e("#id_"+a.prefix+"-TOTAL_FORMS").prop("autocomplete","off"),l=parseInt(r.val(),10),d=e("#id_"+a.prefix+"-MAX_NUM_FORMS").prop("autocomplete","off"),f=""===d.val()||d.val()-r.val()>0;if(i.each(function(){e(this).not("."+a.emptyCssClass).addClass(a.formCssClass)}),i.length&&f){var o;if("TR"==i.prop("tagName")){var c=this.eq(-1).children().length;s.append('<tr class="'+a.addCssClass+'"><td colspan="'+c+'"><a href="javascript:void(0)">'+a.addText+"</a></tr>"),o=s.find("tr:last a")}else i.filter(":last").after('<div class="'+a.addCssClass+'"><a href="javascript:void(0)">'+a.addText+"</a></div>"),o=i.filter(":last").next().find("a");o.click(function(t){t.preventDefault();var i=e("#id_"+a.prefix+"-TOTAL_FORMS"),s=e("#"+a.prefix+"-empty"),r=s.clone(!0);r.removeClass(a.emptyCssClass).addClass(a.formCssClass).attr("id",a.prefix+"-"+l),r.is("tr")?r.children(":last").append('<div><a class="'+a.deleteCssClass+'" href="javascript:void(0)">'+a.deleteText+"</a></div>"):r.is("ul")||r.is("ol")?r.append('<li><a class="'+a.deleteCssClass+'" href="javascript:void(0)">'+a.deleteText+"</a></li>"):r.children(":first").append('<span><a class="'+a.deleteCssClass+'" href="javascript:void(0)">'+a.deleteText+"</a></span>"),r.find("*").each(function(){n(this,a.prefix,i.val())}),r.insertBefore(e(s)),e(i).val(parseInt(i.val(),10)+1),l+=1,""!==d.val()&&d.val()-i.val()<=0&&o.parent().hide(),r.find("a."+a.deleteCssClass).click(function(t){t.preventDefault();var i=e(this).parents("."+a.formCssClass);i.remove(),l-=1,a.removed&&a.removed(i);var s=e("."+a.formCssClass);e("#id_"+a.prefix+"-TOTAL_FORMS").val(s.length),(""===d.val()||d.val()-s.length>0)&&o.parent().show();for(var r=0,f=s.length;f>r;r++)n(e(s).get(r),a.prefix,r),e(s.get(r)).find("*").each(function(){n(this,a.prefix,r)})}),a.added&&a.added(r)})}return this},e.fn.formset.defaults={prefix:"form",addText:"add another",deleteText:"remove",addCssClass:"add-row",deleteCssClass:"delete-row",emptyCssClass:"empty-row",formCssClass:"dynamic-form",added:null,removed:null},e.fn.tabularFormset=function(t){var a=e(this),i=function(){e(a.selector).not(".add-row").removeClass("row1 row2").filter(":even").addClass("row1").end().filter(":odd").addClass("row2")},s=function(){"undefined"!=typeof DateTimeShortcuts&&(e(".datetimeshortcuts").remove(),DateTimeShortcuts.init())},n=function(){"undefined"!=typeof SelectFilter&&(e(".selectfilter").each(function(e,a){var i=a.name.split("-");SelectFilter.init(a.id,i[i.length-1],!1,t.adminStaticPrefix)}),e(".selectfilterstacked").each(function(e,a){var i=a.name.split("-");SelectFilter.init(a.id,i[i.length-1],!0,t.adminStaticPrefix)}))},r=function(t){t.find(".prepopulated_field").each(function(){var a=e(this),i=a.find("input, select, textarea"),s=i.data("dependency_list")||[],n=[];e.each(s,function(e,a){n.push("#"+t.find(".field-"+a).find("input, select, textarea").attr("id"))}),n.length&&i.prepopulate(n,i.attr("maxlength"))})};return a.formset({prefix:t.prefix,addText:t.addText,formCssClass:"dynamic-"+t.prefix,deleteCssClass:"inline-deletelink",deleteText:t.deleteText,emptyCssClass:"empty-form",removed:i,added:function(e){r(e),s(),n(),i(e)}}),a},e.fn.stackedFormset=function(t){var a=e(this),i=function(){e(a.selector).find(".inline_label").each(function(t){var a=t+1;e(this).html(e(this).html().replace(/(#\d+)/g,"#"+a))})},s=function(){"undefined"!=typeof DateTimeShortcuts&&(e(".datetimeshortcuts").remove(),DateTimeShortcuts.init())},n=function(){"undefined"!=typeof SelectFilter&&(e(".selectfilter").each(function(e,a){var i=a.name.split("-");SelectFilter.init(a.id,i[i.length-1],!1,t.adminStaticPrefix)}),e(".selectfilterstacked").each(function(e,a){var i=a.name.split("-");SelectFilter.init(a.id,i[i.length-1],!0,t.adminStaticPrefix)}))},r=function(t){t.find(".prepopulated_field").each(function(){var a=e(this),i=a.find("input, select, textarea"),s=i.data("dependency_list")||[],n=[];e.each(s,function(e,a){n.push("#"+t.find(".form-row .field-"+a).find("input, select, textarea").attr("id"))}),n.length&&i.prepopulate(n,i.attr("maxlength"))})};return a.formset({prefix:t.prefix,addText:t.addText,formCssClass:"dynamic-"+t.prefix,deleteCssClass:"inline-deletelink",deleteText:t.deleteText,emptyCssClass:"empty-form",removed:i,added:function(e){r(e),s(),n(),i(e)}}),a}}(django.jQuery);